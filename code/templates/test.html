<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Data Example</title>
</head>
<body>

<!-- Display initial data -->
<script>
    var data = {{ initial_data|tojson|safe }};
    console.log('Initial data:', data);
</script>

<!-- JavaScript to dynamically update data -->
<script>
    function updateData() {
        // Include the last data version in the request headers
        var headers = new Headers();
        headers.append('Last-Data-Update', data['LastUpdate']);

        fetch('/update_data', {
            headers: headers
        })
        .then(response => response.json())
        .then(updatedData => {
            console.log('Updated data:', updatedData);

            // Update variables in JavaScript
            for (var key in updatedData) {
                if (updatedData.hasOwnProperty(key)) {
                    data[key] = updatedData[key];
                }
            }

            // Example: Update the HTML to reflect the changes
            document.getElementById('output').innerHTML = 'Updated data: ' + JSON.stringify(data);
        })
        .catch(error => console.error('Error fetching data:', error));
    }

    // Example: Call the updateData function every 5 seconds
    setInterval(updateData, 5000);
</script>

<!-- Example: Display the updated data on the page -->
<div id="output">Initial data: {{ initial_data|tojson|safe }}</div>

</body>
</html>
